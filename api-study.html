<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="">
</head>

<body>
  <div id="root"></div>
  <!-- todo : 비동기 통신 AJAX 기술을 사용하기 위한 사전 준비 -->
  <!-- 
    work .1 http://kobis.or.kr/kobisopenapi/homepg/main/main.do 
   -->
  <script>
    const ajax = new XMLHttpRequest();
    // console.dir(ajax);
    // 	http://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=f5eef3421c602c6cb7ea224104795888&targetDt=20120101
    // <!--?key를 신청해서 받은 부분을 문자열로 대입해줄 변수
    const myKey = `420782fb2a083bedd87f972af2385b05`;
    // <!--?조회하고자하는 날짜 => 이 부분에 요청 인터페이스와 알맞은 타입의 값을 넣어서 요청하면 된다
    // <!--todo: 이 부분에 검색하고자 하는 변수, 버튼이 들어가야 한다 
    // <!--*제임스완은 나온다, 띄어쓰기 없어도 됨, 띄어쓰기 해서 검색해도 잘 응답을 해준다
    //<!--todo: 고전 공포 영화도 소개할 것이므로 옛날 영화도 검색이 가능한지 알아봐야 한다 => 다리오 아르젠토, 알프레드 히치콕 등도 검색 가능
    //<!--todo: 버튼을 클릭하면 문자열에서 감독 이름의 부분에 클릭한 버튼에 쓰여진 감독의 이름이 들어가서 ajax로부터 응답받아야 한다
    

    const director = `directorNm=대런 린 바우즈먼`;
    const name = `movieNm=랑종`;
    // 영화유형 코드
    const releaseYear = `openStartDt=2020`;
    const genre = `movieTypeCd=default`;
    // <!--? rest 방식의 url을 .json 확장자 전까지 붙여넣어주고
    // <!--?응답 예시
    // <!--?http://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=f5eef3421c602c6cb7ea224104795888&targetDt=20120101
    // <!--?itemPerPage = 결과값 row의 개수
    // <!--*영화 목록 조회 API 서비스 카테고리에서 사용방법 보기 
    // <!--? 국적 코드 
    // https://www.kobis.or.kr/kobisopenapi/homepg/apiservice/searchServiceInfo.do?serviceId=searchMovieList
    const _URL = ` http://www.kobis.or.kr/kobisopenapi/webservice/rest/movie/searchMovieList.json?key=${myKey}&${director}&itemPerPage=20`;
    // console.log(_URL);
    // <!--? 요청 parameter : 3번항의 요청 인터페이스 정보를 참조하여 GET 방식으로 호출
    // <!--? 서버로부터 데이터를 가져오는 GET 요청 방식, 서버에 데이터를 등록하는 POST 요청 방식
    ajax.open("GET", _URL);
    // 응답해주는 타입? => JSON
    ajax.responseType = "json";
    ajax.send();

    let moviePrint = '';
    ajax.addEventListener('load', () => {
      const _movieAPI = ajax.response;
      console.table(_movieAPI); //이 부분에서 응답을 받은 결과를 출력해준다
      const movieName = _movieAPI.movieListResult.movieList;
      // const boxOfficeList = _movieAPI.boxOfficeResult.dailyBoxOfficeList;
      for (let i = 0; i < movieName.length; i++) {
        // <!--todo: console을 보면 답이 나온다! 객체 구조를 잘 보도록 하자!
          console.log(`${_movieAPI.movieListResult.movieList[i].movieNm}`);
          const title = _movieAPI.movieListResult.movieList[i];
        // <!--장르가 문자열 값과 같을 때만 출력이 되도록 해야한다
        // <!--*드디어 장르를 한번 거쳐서 감독의 작품이 출력된다!
        if(title.genreAlt.includes('스릴러') || title.genreAlt.includes('공포(호러)') || title.genreAlt.includes('미스터리') ){
          // moviePrint += `<div>${title.movieNm}</div>`;
          let index = i+1;
          moviePrint += makeResultList(index+'.\n\n'+title.movieNm+'\n|\n'+title.directors[0].peopleNm);
          console.log(title.directors[0].peopleNm);
        } else if(title.genreAlt.includes('오컬트')){
          // <!--? 오컬트 키워드가 없어서 사전에 오컬트 영화를 잘 만드는 감독들을 조사해야할 부분들
          console.log('오컬트 장르가 있습니다.')
        }
      }
      const root = document.getElementById('root');
      console.log(moviePrint);
      console.log(root);
      root.innerHTML = moviePrint;
    });
    // const movieName = _movieAPI.
    const makeResultList = function(contents){
      return `<div>${contents}</div>`;
    } 
  </script>
</body>

</html>